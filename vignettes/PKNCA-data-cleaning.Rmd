<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{Data Cleaning in PKNCA}
-->

Data cleaning is vital for accuracy in results.  In this vignette, we
will describe the methods for data cleaning in the PKNCA package.
Data cleaning is integrated into the package to allow improved
tracking of the data from start to finish.

# Data Cleaning Operations #

PKNCA has three cleaning operations: `add`, `exclude`, and `modify`.
The `add` operation inserts new data rows without modifying or
removing existing data rows.  The `exclude` operation removes data
rows from the existing data rows.  The `modify`
operation updates the contents of data rows; if all elements in a data
row are modified, that will count as an `add` and `exclude` operation
rather than a modification.

To specify a data cleaning operation, the operation, the function, and
any optional arguments must be given.  The components are given as a
list with elements named `operation`, `FUN`, and `args`.  `operation`
must be a character string of "add", "exclude", or "modify".  `FUN`
must be either a function or a character string that can be used with
the `get` function to define the function.  The `args` list element is
optional, and it consists of a named list of arguments given to the
function in addition to the standard arguments.  Two examples are
given below.

```{r eval=FALSE}
list(operation="add",
     FUN=clean.predose)
```

```{r eval=FALSE}
list(operation="exclude",
     FUN=excludepredose,
     args=list(time=0))
```

For information on how the functions are called, see the next section.

# Data Cleaning Opportunities #

Data can be cleaned at multiple times and in multiple ways during
evaluation.  Not all operations are available at all times.  During
concentration and dose data object creation, when the concentration
and dose data are combined, and with the results are calculated.
Before the results are calculated, all operations are available, but
after results are calculated, only the exclude operation is available
for use.

* Concentration object creation (available operations: add, exclude,
  modify)
    * Before object creation (`before`)
	* After object creation (`after`)
* Dose object creation (available operations: add, exclude, modify)
    * Before object creation (`before`)
	* After object creation (`after`)
* Data object creation (combination of concentration and dose;
  available operations: add, exclude, modify)
	* After object creation (`after`; this level in the
      list is optional since it is the only choice)
		* Full data object (`full`)
		* Individual intervals (`interval`)
* Results object (calculated parameters; available operation: exclude)
	* After object creation (`after`; this level in the
      list is optional since it is the only choice)

At each of the opportunities for data cleaning, multiple cleaning
methods can be used in sequence.  Cleaning is specified by nested
lists.  Two examples are given below.

**Concentration object**
```{r eval=FALSE}
list(before=list(
         list(operation="exclude",
              FUN=clean.emptyrows),
         list(operation="modify",
              FUN=clean.setblq,
              args=list(regex="^<[0-9.]+$"))),
     after=list(
         list(operation="modify",
              FUN=clean.predose)))
```

**Results object** (Both methods are equivalent since `after` is the only option.)
```{r eval=FALSE}
list(after=list(
         list(operation="exclude",
              FUN=clean.outliers)))

list(
    list(operation="exclude",
         FUN=clean.outliers))
```
