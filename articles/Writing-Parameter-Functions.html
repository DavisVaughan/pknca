<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Writing PKNCA Parameter Functions • PKNCA</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Writing PKNCA Parameter Functions">
<meta property="og:description" content="PKNCA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PKNCA</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AUC-Calculation-with-PKNCA.html">AUC Calculation with PKNCA</a>
    </li>
    <li>
      <a href="../articles/Example-theophylline.html">Computing NCA Parameters for Theophylline</a>
    </li>
    <li>
      <a href="../articles/Half-Life-Calculation.html">Half-Life Calculation</a>
    </li>
    <li>
      <a href="../articles/Introduction-and-Usage.html">Introduction to PKNCA and Usage Instructions</a>
    </li>
    <li>
      <a href="../articles/Methods-for-Dose-Aware-Interpolation-and-Extrapolation.html">Methods Used for Dose-Aware Concentration Interpolation/Extrapolation</a>
    </li>
    <li>
      <a href="../articles/Options-for-Controlling-PKNCA.html">Options for Controlling PKNCA</a>
    </li>
    <li>
      <a href="../articles/PKNCA-validation.html">PKNCA Validation</a>
    </li>
    <li>
      <a href="../articles/Post-Processing.html">Post-Processing</a>
    </li>
    <li>
      <a href="../articles/Selection-of-Calculation-Intervals.html">Selection of Calculation Intervals</a>
    </li>
    <li>
      <a href="../articles/Superposition.html">Superposition of Pharmacokinetic Data</a>
    </li>
    <li>
      <a href="../articles/Training-Session.html">PKNCA Training Sessions</a>
    </li>
    <li>
      <a href="../articles/Writing-Parameter-Functions.html">Writing PKNCA Parameter Functions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/billdenney/pknca/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Writing-Parameter-Functions_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Writing PKNCA Parameter Functions</h1>
                        <h4 class="author">Bill Denney</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/billdenney/pknca/blob/master/vignettes/Writing-Parameter-Functions.Rmd"><code>vignettes/Writing-Parameter-Functions.Rmd</code></a></small>
      <div class="hidden name"><code>Writing-Parameter-Functions.Rmd</code></div>

    </div>

    
    
<div id="writing-pknca-parameter-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#writing-pknca-parameter-functions" class="anchor"></a>Writing PKNCA Parameter Functions</h1>
<p>The PKNCA package is designed to be comprehensive in its coverage of the needs of an noncompartmental analysis (NCA) specialist. While it has many NCA parameters specified, it may not have all parameters defined, and its design is modular to accept new parameter definitions. From its inception, PKNCA is built in modules to allow addition of new components (or removal of unnecessary ones). Defining new NCA parameters is straight-forward, and this guide will describe how it is done. The three parts to writing a new NCA parameter in PKNCA are described below.</p>
</div>
<div id="writing-the-parameter-function" class="section level1">
<h1 class="hasAnchor">
<a href="#writing-the-parameter-function" class="anchor"></a>Writing the Parameter Function</h1>
<div id="requirements" class="section level2">
<h2 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h2>
<p>The starting point to writing a new NCA parameter is writing the function that calculates the parameter value. The function can be passed any of the following arguments. The arguments must be named as described below:</p>
<ul>
<li>
<code>conc</code> is the numeric vector of plasma concentrations for an interval for a single group (usually a single analyte for a single subject in a single study).</li>
<li>
<code>time</code> is the numeric vector of the time for plasma concentration measurements.</li>
<li>
<code>duration.conc</code> is the duration of a concentration measurement (usually for urine or fecal measurements)</li>
<li>
<code>dose</code> is the numeric vector of dose amounts for an interval for a single group. NOTE: This is a vector and not always a scalar. If your function expects a scalar, you should usually take the sum of the dose argument.</li>
<li>
<code>time.dose</code> is the numeric vector of time for the doses.</li>
<li>
<code>duration.dose</code> is the duration of a dose (usually for intravenous infusions)</li>
<li>
<code>start</code> and <code>end</code> are the scalar numbers for the start and end time of the current interval. NOTE: <code>end</code> may be <code>Inf</code> (infinity).</li>
<li>
<code>options</code> are the PKNCA options used for the current calculation usually as defined by the <code>PKNCA.option</code> function (though these options may be over-ridden by the <code>options</code> argument to the <code>PKNCAdata</code> function.</li>
<li>Or, any NCA parameters by name (as given by <code>names(get.interval.cols())</code>).</li>
</ul>
<p>The function should return either a scalar which is the value for the parameter (usually the case) or a data.frame with parameters named for each parameter calculated. For an example of returning a data.frame, see the <code>half.life</code> function.</p>
<p>The return value may have an attribute of <code>exclude</code> (set by <code>attr(return_value, "exclude") &lt;- "reason"</code>). If the <code>exclude</code> attribute is set to a character string, then that string will be included in the <code>exclude</code> column for results. If any of the input parameters have an exclude attribute set, then those are also added to the <code>exclude</code> column. The exception to the setting of the <code>exclude</code> column is if the <code>exclude</code> attribute is <code>"DO NOT EXCLUDE"</code>, then the <code>exclude</code> column is set to <code>NA_character_</code>.</p>
</div>
<div id="best-practices" class="section level2">
<h2 class="hasAnchor">
<a href="#best-practices" class="anchor"></a>Best Practices</h2>
<ul>
<li>Use the function <code>check.conc.time</code> if the function takes either <code>conc</code> or <code>time</code> as an input.</li>
<li>Make sure that you check for missing values (<code>NA</code>) in your inputs.</li>
<li>Don’t recalculate other NCA parameters within your function unless you absolutely must. Take the NCA parameter as an input. That way, PKNCA will track the calculation dependencies.</li>
<li>For consistency with the rest of PKNCA, start the function name with “pk.calc” (like “pk.calc.cmax”).</li>
</ul>
</div>
</div>
<div id="tell-pknca-about-the-parameter" class="section level1">
<h1 class="hasAnchor">
<a href="#tell-pknca-about-the-parameter" class="anchor"></a>Tell PKNCA about the Parameter</h1>
<p>Just writing a function doesn’t connect it to the rest of PKNCA. You have to tell PKNCA that the function exists and a few more details about it. To do this, you need to use the <code>add.interval.col</code> function. The function takes up to seven arguments:</p>
<ul>
<li>
<code>name</code> is the name of the parameter (as a character string).</li>
<li>
<code>FUN</code> is the function name (as a character string).</li>
<li>
<code>values</code> are the possible values for the interval column (currently only <code>TRUE</code> and <code>FALSE</code> are supported).</li>
<li>
<code>depends</code> is a character vector of columns that must exist before this column can be created. Use this to tell PKNCA about calculation dependencies (parameter X must be calculated to be able to calculate parameter Y).</li>
<li>
<code>formalsmap</code> remaps the (formal) function arguments. <code>formalsmap</code> is usually used when the same function may be used for multiple different parameters, for example the function <code>pk.calc.thalf.eff</code> is used to calculate the parameters <code>thalf.eff.obs</code>, <code>thalf.eff.pred</code>, <code>thalf.eff.last</code>, <code>thalf.eff.iv.obs</code>, <code>thalf.eff.iv.pred</code>, and <code>thalf.eff.iv.last</code> with different mean residence time inputs.</li>
<li>
<code>desc</code> is a text description of the parameter.</li>
</ul>
</div>
<div id="tell-pknca-how-to-summarize-the-parameter" class="section level1">
<h1 class="hasAnchor">
<a href="#tell-pknca-how-to-summarize-the-parameter" class="anchor"></a>Tell PKNCA How to Summarize the Parameter</h1>
<p>For any parameter, PKNCA needs to know how to summarize it for the <code>summary</code> function of the <code>PKNCAresults</code> class. To tell PKNCA how to summarize a parameter, use the <code>PKNCA.set.summary</code> function. It takes at least these four arguments:</p>
<ul>
<li>
<code>name</code> must match an already existing parameter name (added by the <code>add.interval.col</code> function).</li>
<li>
<code>description</code> is a human-readable description of the <code>point</code> and <code>spread</code> for use in table captions.</li>
<li>
<code>point</code> is the function to calculate the point estimate (called as <code>point(x)</code>, and it must return a scalar).</li>
<li>
<code>spread</code> is the function to calculate the spread (or variability). The function will be called as <code>spread(x)</code> and must return a scalar or a two-long vector.</li>
</ul>
</div>
<div id="putting-it-together" class="section level1">
<h1 class="hasAnchor">
<a href="#putting-it-together" class="anchor"></a>Putting It Together</h1>
<p>One of the most common examples is the function to calculate C<sub>max</sub>:</p>
<pre><code>#' Determine maximum observed PK concentration
#'
#' @param conc Concentration measured
#' @param check Run \code{\link{check.conc.time}}?
#' @return a number for the maximum concentration or NA if all
#' concentrations are missing
#' @export
pk.calc.cmax &lt;- function(conc, check=TRUE) {
  if (check)
    check.conc.time(conc=conc)
  if (length(conc) == 0 | all(is.na(conc))) {
    NA
  } else {
    max(conc, na.rm=TRUE)
  }
}
## Add the column to the interval specification
add.interval.col("cmax",
                 FUN="pk.calc.cmax",
                 values=c(FALSE, TRUE),
                 desc="Maximum observed concentration",
                 depends=c())
PKNCA.set.summary("cmax", "geometric mean and geometric coefficient of variation", business.geomean, business.geocv)</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bill Denney, Clare Buckeridge.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
